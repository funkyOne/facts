{"version":3,"sources":["db.js"],"names":[],"mappings":"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","file":"db.js","sourcesContent":["angular.module(\"p7\")\r\n    .service(\"Facts1\", [\"$q\", \"$http\", function ($q, $http) {\r\n\r\n        //var facts = JSON.parse(localStorage.getItem(\"facts\")) || [];\r\n\r\n        var facts = undefined;//JSON.parse(localStorage.getItem(\"facts\")) || [];\r\n\r\n        var req = $http.get(\"/facts\").success(function (data) {\r\n            facts = data;\r\n\r\n            initialize();\r\n        });\r\n\r\n        var categories = [];\r\n\r\n        function initialize() {\r\n            facts.forEach(addFactCats);\r\n        }\r\n\r\n        function add(fact) {\r\n            fact.id = facts.length;\r\n            var md = new Remarkable();\r\n            fact.html = md.render(fact.text);\r\n            facts[fact.id] = fact;\r\n            addFactCats(fact);\r\n        }\r\n\r\n        function addFactCats(fact) {\r\n            fact.categories && fact.categories.forEach(addCat)\r\n        }\r\n\r\n        function factsForCategory(cat) {\r\n            return _.filter(facts, function (fact) {\r\n                return fact.categories && _.includes(fact.categories, cat);\r\n            })\r\n        }\r\n\r\n        function addCat(cat) {\r\n            if (!_.includes(categories, cat)) {\r\n                categories.push(cat);\r\n            }\r\n        }\r\n\r\n        function persist() {\r\n            $http.put(\"/facts\", JSON.stringify(facts));\r\n            //localStorage.setItem(\"facts\", JSON.stringify(facts));\r\n        }\r\n\r\n        function getFact(id) {\r\n            return _.findWhere(facts, {id: id});\r\n        }\r\n\r\n        var api = {\r\n            initialized: req,\r\n            all: function () {\r\n                return facts;\r\n            },\r\n            categories: function () {\r\n                return categories.map(function (cat) {\r\n                    return {\r\n                        key: cat,\r\n                        title: _.capitalize(cat),\r\n                        facts: factsForCategory(cat)\r\n                    }\r\n                })\r\n            },\r\n            add: function (fact) {\r\n                facts.push(fact);\r\n                persist()\r\n            },\r\n            update: function (fact) {\r\n                var factIndex = _.findIndex(facts, {id: fact.id});\r\n\r\n                facts.splice(factIndex, 1, fact);\r\n            },\r\n            remove: function (id) {\r\n                facts[id].removed = true;\r\n                persist();\r\n            },\r\n            deleteFact: function (fact, category) {\r\n                var f = getFact(fact.id);\r\n\r\n                _.remove(f.categories, function (c) {\r\n                    return c === category.key\r\n                });\r\n                persist();\r\n            },\r\n            reset: function () {\r\n                facts = [];\r\n                persist();\r\n            },\r\n            findCategories: function (text) {\r\n                var re = new RegExp(text);\r\n\r\n                return $q.when(_.filter(categories, function (cat) {\r\n                    return re.test(cat);\r\n                }))\r\n            }\r\n        };\r\n\r\n        return api;\r\n    }]);\r\n\r\nclass FactService {\r\n    constructor($q, $http) {\r\n        this.$q = $q;\r\n        this.$http = $http;\r\n\r\n        this.initialized = $http.get(\"/facts\").success(data => {\r\n            this.categories = data;\r\n        });\r\n    }\r\n\r\n    update(fact) {\r\n        return this.$http.put(`/facts/${fact.id}`, fact)\r\n    }\r\n\r\n    removeFactFromCategory(fact, category) {\r\n        var index = category.facts.findIndex(f=> f.id === fact.id);\r\n\r\n        if (index === -1) {\r\n            return;\r\n        }\r\n\r\n        category.facts.splice(index, 1);\r\n        return this.$http.delete(`/categories/${category.id}/facts`, {params: {fact_id: fact.id}});\r\n    }\r\n}\r\n\r\nFactService.$inject = [\"$q\", \"$http\"];\r\nangular.module(\"p7\").service(\"Facts\", FactService);"],"sourceRoot":"/source/"}